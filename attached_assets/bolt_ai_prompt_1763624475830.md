# Project Brief for Bolt AI

## Project Overview
Build a full-stack web application that processes user data through Python backend services with session management.

---

## Website Configuration
**Important:** Use a variable-based naming system throughout the project:
```javascript
const WEBSITE_NAME = "WebTool"; // Change this variable to update the name everywhere
```

Use `${WEBSITE_NAME}` or `WEBSITE_NAME` constant in all files where the website name appears:
- Page titles
- Headers
- Meta tags
- Footer
- API endpoints
- Documentation

---

## Technical Stack

### Frontend
- **Framework:** Node.js with Express.js
- **Template Engine:** EJS or Handlebars (for dynamic content)
- **Styling:** Modern CSS framework (Tailwind CSS or Bootstrap)
- **Client-side JS:** Vanilla JavaScript or lightweight framework

### Backend
- **Server:** Node.js + Express.js
- **Python Integration:** Child process execution or Python shell
- **Session Management:** express-session with memory store or Redis
- **File Handling:** Multer for file uploads

### Communication Layer
- **API:** RESTful API endpoints
- **Data Format:** JSON for data exchange
- **Session Storage:** Server-side session with unique session IDs

---

## Architecture & Data Flow

### Step 1: Frontend Data Collection
```
User Input (Website) → Form Data/Files → POST Request
```

**Requirements:**
- Create HTML forms to collect user data
- Support file uploads (multiple files if needed)
- Validate input on client-side
- Show loading states during processing

### Step 2: Node.js Server Receives Data
```
Express Route Handler → Parse Request → Store in Session
```

**Implementation:**
```javascript
app.post('/api/process', upload.array('files'), async (req, res) => {
  // 1. Extract form data
  const userData = req.body;
  const files = req.files;
  
  // 2. Create unique session ID
  const sessionId = req.session.id;
  
  // 3. Store data temporarily
  req.session.userData = userData;
  req.session.files = files.map(f => f.path);
  
  // 4. Send to Python
  // (Next step)
});
```

### Step 3: Send Data to Python
```
Node.js → Spawn Python Process → Pass Data as JSON
```

**Methods to Connect:**
1. **Child Process (Recommended for simple tasks):**
```javascript
const { spawn } = require('child_process');

const python = spawn('python', ['script.py', JSON.stringify(data)]);
```

2. **Python Shell (Better for complex interactions):**
```javascript
const { PythonShell } = require('python-shell');

PythonShell.run('script.py', {
  mode: 'json',
  args: [sessionId, dataPath]
}, (err, results) => {
  // Handle results
});
```

### Step 4: Python Processing
```
Python Receives Data → Process Files → Return Results
```

**Python Script Structure:**
```python
import sys
import json

def main():
    # 1. Receive session ID and data
    session_id = sys.argv[1]
    data = json.loads(sys.argv[2])
    
    # 2. Process data
    # - Read files
    # - Perform computations
    # - Generate results
    
    # 3. Store results with session ID
    results = {
        'session_id': session_id,
        'processed_data': processed_results,
        'status': 'success'
    }
    
    # 4. Return JSON to Node.js
    print(json.dumps(results))

if __name__ == '__main__':
    main()
```

### Step 5: Store Results in Session
```
Python Output → Node.js Receives → Store in Session by ID
```

**Implementation:**
```javascript
python.stdout.on('data', (data) => {
  const results = JSON.parse(data.toString());
  
  // Store results in session
  req.session.results = results;
  req.session.processedAt = new Date();
  
  // Send response to frontend
  res.json({
    success: true,
    sessionId: req.session.id,
    results: results
  });
});
```

### Step 6: Frontend Displays Results
```
AJAX Response → Update UI → Show Processed Data
```

---

## Project Structure

```
project/
├── server.js              # Main Node.js server
├── package.json           # Dependencies
├── config/
│   └── config.js         # Configuration (including WEBSITE_NAME)
├── routes/
│   ├── index.js          # Main routes
│   └── api.js            # API endpoints
├── python/
│   ├── processor.py      # Main Python script
│   └── requirements.txt  # Python dependencies
├── public/
│   ├── css/
│   ├── js/
│   └── uploads/          # Temporary file storage
├── views/
│   ├── index.ejs         # Home page
│   └── results.ejs       # Results page
└── sessions/             # Session storage
```

---

## Key Features to Implement

### 1. Session Management
- Generate unique session ID for each user
- Store user data, uploaded files, and results per session
- Session expiry (30 minutes of inactivity)
- Clean up old sessions and files

### 2. File Handling
- Accept multiple file uploads
- Validate file types and sizes
- Store files temporarily with session ID
- Delete files after processing or session expiry

### 3. Python Integration
- Pass data securely to Python
- Handle Python errors gracefully
- Stream Python output for long-running processes
- Return structured results

### 4. Error Handling
- Validate all inputs
- Handle Python script failures
- Provide user-friendly error messages
- Log errors for debugging

### 5. UI/UX
- Responsive design
- Progress indicators
- Real-time status updates
- Download results option

---

## NPM Packages Required

```json
{
  "dependencies": {
    "express": "^4.18.0",
    "express-session": "^1.17.0",
    "multer": "^1.4.0",
    "python-shell": "^5.0.0",
    "dotenv": "^16.0.0",
    "ejs": "^3.1.0",
    "body-parser": "^1.20.0",
    "cors": "^2.8.0"
  }
}
```

---

## Python Requirements

```
Create requirements.txt with necessary packages for your data processing
```

---

## Environment Variables (.env)

```env
PORT=3000
SESSION_SECRET=your-secret-key-here
PYTHON_PATH=python3
UPLOAD_DIR=./public/uploads
SESSION_MAX_AGE=1800000
WEBSITE_NAME=WebTool
```

---

## Implementation Steps

1. **Initialize Project**
   - Set up Node.js project with Express
   - Install all dependencies
   - Create folder structure

2. **Configure Website Name Variable**
   - Create config file with WEBSITE_NAME constant
   - Import and use throughout the application

3. **Build Frontend**
   - Create forms for data input
   - Add file upload interface
   - Implement AJAX for API calls

4. **Set Up Node.js Server**
   - Configure Express routes
   - Set up session middleware
   - Implement file upload handling

5. **Create Python Bridge**
   - Write Python processing script
   - Set up Node-Python communication
   - Test data flow

6. **Implement Session Logic**
   - Generate and manage session IDs
   - Store user data per session
   - Handle session cleanup

7. **Add Error Handling**
   - Validate all inputs
   - Handle edge cases
   - Provide feedback

8. **Testing**
   - Test full data flow
   - Test session management
   - Test error scenarios

---

## Example API Endpoints

```javascript
// Submit data for processing
POST /api/process
Body: { userData, files }
Response: { sessionId, status }

// Get processing status
GET /api/status/:sessionId
Response: { status, progress }

// Get results
GET /api/results/:sessionId
Response: { results, downloadUrl }

// Clear session
DELETE /api/session/:sessionId
Response: { success }
```

---

## Notes for Bolt AI

- Make all code production-ready with proper error handling
- Add comments explaining the data flow
- Use modern ES6+ JavaScript syntax
- Ensure Python script is well-documented
- Include instructions for running the project
- Make the website name easily changeable via the config variable
- Provide sample data for testing

---

## Final Deliverables

1. Complete working Node.js application
2. Python processing script
3. README.md with setup instructions
4. Configuration file with WEBSITE_NAME variable
5. Sample test data
6. Documentation of API endpoints